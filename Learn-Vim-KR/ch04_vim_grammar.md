# Ch04. Vim 문법

Vim 명령어의 복잡성에 압도되기 쉽습니다. Vim 사용자가 `gUfV`나 `1GdG`와 같은 명령어를 사용하는 것을 보면, 이 명령어들이 무엇을 하는지 즉시 알 수 없을 수도 있습니다. 이 장에서는 Vim 명령어의 일반적인 구조를 간단한 문법 규칙으로 나누어 설명하겠습니다.

이 장은 전체 가이드에서 가장 중요한 장입니다. 기본적인 문법 구조를 이해하면 Vim과 "대화"할 수 있게 될 것입니다. 참고로, 이 장에서 *Vim 언어*라고 말할 때, 저는 Vimscript 언어(Vim의 내장 프로그래밍 언어, 나중 장에서 배울 것입니다)를 말하는 것이 아닙니다.

## 언어를 배우는 방법

저는 영어가 모국어가 아닙니다. 13살 때 미국으로 이사하면서 영어를 배웠습니다. 새로운 언어를 말하는 법을 배우려면 세 가지를 해야 합니다:

1. 문법 규칙을 배운다.
2. 어휘를 늘린다.
3. 연습, 연습, 연습.

마찬가지로, Vim 언어를 말하려면 문법 규칙을 배우고, 어휘를 늘리고, 생각 없이 명령어를 실행할 수 있을 때까지 연습해야 합니다.

## 문법 규칙

Vim 언어에는 단 하나의 문법 규칙만 있습니다:

```
동사 + 명사
```

그게 다입니다!

이것은 다음과 같은 영어 구문을 말하는 것과 같습니다:

- *"도넛을(명사) 먹어라(동사)"*
- *"공을(명사) 차라(동사)"*
- *"Vim 편집기를(명사) 배워라(동사)"*

이제 기본적인 Vim 동사와 명사로 어휘를 쌓아야 합니다.

## 명사 (모션)

명사는 Vim 모션입니다. 모션은 Vim에서 이동하는 데 사용됩니다. 다음은 일부 Vim 모션 목록입니다:

```
h    왼쪽
j    아래
k    위
l    오른쪽
w    다음 단어의 시작으로 앞으로 이동
}    다음 문단으로 점프
$    줄의 끝으로 이동
```

다음 장에서 모션에 대해 더 배울 것이므로, 일부를 이해하지 못하더라도 너무 걱정하지 마세요.

## 동사 (연산자)

`:h operator`에 따르면, Vim에는 16개의 연산자가 있습니다. 하지만 제 경험상, 다음 3개의 연산자를 배우는 것만으로도 제 편집 요구의 80%를 충족시키기에 충분합니다:

```
y    텍스트 복사 (Yank)
d    텍스트 삭제 및 레지스터에 저장
c    텍스트 삭제, 레지스터에 저장, 그리고 삽입 모드 시작
```

참고로, 텍스트를 복사한 후에는 `p`(커서 뒤) 또는 `P`(커서 앞)로 붙여넣을 수 있습니다.

## 동사와 명사

이제 기본적인 명사와 동사를 알았으니, 문법 규칙인 동사 + 명사를 적용해 봅시다! 다음과 같은 표현식이 있다고 가정해 봅시다:

```javascript
const learn = "vim";
```

- 현재 위치에서 줄 끝까지 모든 것을 복사하려면: `y$`.
- 현재 위치에서 다음 단어의 시작까지 삭제하려면: `dw`.
- 현재 위치에서 현재 문단의 끝까지 변경하려면, `c}`라고 말하세요.

모션은 또한 횟수를 인수로 받습니다 (다음 장에서 이것을 논의할 것입니다). 3줄 위로 올라가야 한다면, `k`를 3번 누르는 대신 `3k`를 할 수 있습니다. 횟수는 Vim 문법과 함께 작동합니다.
- 왼쪽으로 두 문자를 복사하려면: `y2h`.
- 다음 두 단어를 삭제하려면: `d2w`.
- 다음 두 줄을 변경하려면: `c2j`.

지금 당장은 간단한 명령어를 실행하는 데에도 오래 생각해야 할 수도 있습니다. 여러분만 그런 것이 아닙니다. 저도 처음 시작했을 때 비슷한 어려움을 겪었지만 시간이 지나면서 빨라졌습니다. 여러분도 그럴 것입니다. 반복, 반복, 반복.

참고로, 줄 단위 작업(전체 줄에 영향을 미치는 작업)은 텍스트 편집에서 일반적인 작업입니다. 일반적으로 연산자 명령어를 두 번 입력하면 Vim은 해당 작업에 대한 줄 단위 작업을 수행합니다. 예를 들어, `dd`, `yy`, `cc`는 각각 전체 줄에 대한 **삭제**, **복사**, **변경**을 수행합니다. 다른 연산자들과 함께 이것을 시도해보세요!

이것은 정말 멋집니다. 여기서 패턴을 보고 있습니다. 하지만 아직 끝나지 않았습니다. Vim에는 한 가지 더 종류의 명사가 있습니다: 텍스트 객체.

## 더 많은 명사 (텍스트 객체)

`(hello Vim)`과 같은 괄호 쌍 안 어딘가에 있고 괄호 안의 전체 구문을 삭제해야 한다고 상상해보세요. 어떻게 빨리 할 수 있을까요? 여러분이 있는 "그룹"을 삭제할 방법이 있을까요?

답은 '예'입니다. 텍스트는 종종 구조화되어 있습니다. 종종 괄호, 따옴표, 대괄호, 중괄호 등을 포함합니다. Vim에는 텍스트 객체로 이 구조를 캡처하는 방법이 있습니다.

텍스트 객체는 연산자와 함께 사용됩니다. 텍스트 객체에는 내부(inner)와 외부(outer) 두 가지 유형이 있습니다.

```
i + 객체    내부 텍스트 객체
a + 객체    외부 텍스트 객체
```

내부 텍스트 객체는 공백이나 주변 객체 *없이* 내부의 객체를 선택합니다. 외부 텍스트 객체는 공백이나 주변 객체를 *포함하여* 내부의 객체를 선택합니다. 일반적으로 외부 텍스트 객체는 항상 내부 텍스트 객체보다 더 많은 텍스트를 선택합니다. 커서가 `(hello Vim)` 표현식의 괄호 안 어딘가에 있다면:
- 괄호를 삭제하지 않고 괄호 안의 텍스트를 삭제하려면: `di(`.
- 괄호와 그 안의 텍스트를 삭제하려면: `da(`.

다른 예를 살펴봅시다. 다음과 같은 자바스크립트 함수가 있고 커서가 "Hello"의 "H"에 있다고 가정해 봅시다:

```javascript
const hello = function() {
  console.log("Hello Vim");
  return true;
}
```

- 전체 "Hello Vim"을 삭제하려면: `di(`.
- 함수 내용(`{}`로 둘러싸인 부분)을 삭제하려면: `di{`.
- "Hello" 문자열을 삭제하려면: `diw`.

텍스트 객체는 한 위치에서 다른 객체를 타겟팅할 수 있기 때문에 강력합니다. 괄호 안의 객체, 함수 블록 또는 현재 단어를 삭제할 수 있습니다. 기억하기 쉽게, `di(`, `di{`, `diw`를 보면 각각 괄호 쌍, 중괄호 쌍, 단어를 나타내는 텍스트 객체라는 것을 꽤 잘 알 수 있습니다.

마지막 예를 하나 더 살펴봅시다. 다음과 같은 HTML 태그가 있다고 가정해 봅시다:

```html
<div>
  <h1>Header1</h1>
  <p>Paragraph1</p>
  <p>Paragraph2</p>
</div>
```

커서가 "Header1" 텍스트에 있다면:
- "Header1"을 삭제하려면: `dit`.
- `<h1>Header1</h1>`을 삭제하려면: `dat`.

커서가 "div"에 있다면:
- `h1`과 두 `p` 줄을 삭제하려면: `dit`.
- 모든 것을 삭제하려면: `dat`.
- "div"를 삭제하려면: `di<`.

다음은 일반적인 텍스트 객체 목록입니다:

```
w         단어
p         문단
s         문장
( or )    ( ) 쌍
{ or }    { } 쌍
[ or ]    [ ] 쌍
< or >    < > 쌍
t         XML 태그
"         " " 쌍
'         ' ' 쌍
`         ` ` 쌍
```

더 배우려면 `:h text-objects`를 확인하세요.

## 조합성과 문법

Vim 문법은 Vim의 조합성 기능의 일부입니다. Vim의 조합성과 이것이 텍스트 편집기에서 왜 훌륭한 기능인지 논의해 봅시다.

조합성이란 더 복잡한 명령어를 수행하기 위해 조합(구성)될 수 있는 일반적인 명령어 집합을 갖는 것을 의미합니다. 프로그래밍에서 더 간단한 추상화로부터 더 복잡한 추상화를 만들 수 있는 것처럼, Vim에서는 더 간단한 명령어로부터 복잡한 명령어를 실행할 수 있습니다. Vim 문법은 Vim의 조합 가능한 본성의 표현입니다.

Vim의 조합성의 진정한 힘은 외부 프로그램과 통합될 때 빛을 발합니다. Vim에는 외부 프로그램을 우리 텍스트의 필터로 사용하는 필터 연산자(`!`)가 있습니다. 아래와 같이 지저분한 텍스트가 있고 이것을 표로 만들고 싶다고 가정해 봅시다:

```
Id|Name|Cuteness
01|Puppy|Very
02|Kitten|Ok
03|Bunny|Ok
```

이것은 Vim 명령어로 쉽게 할 수 없지만, `column` 터미널 명령어(터미널에 `column` 명령어가 있다고 가정)로 빠르게 할 수 있습니다. 커서를 "Id"에 놓고 `!}column -t -s "|"`를 실행하세요. 짜잔! 이제 단 하나의 빠른 명령어로 이 예쁜 표 형식의 데이터를 얻었습니다.

```
Id  Name    Cuteness
01  Puppy   Very
02  Kitten  Ok
03  Bunny   Ok
```

명령어를 분석해 봅시다. 동사는 `!`(필터 연산자)이고 명사는 `}`(다음 문단으로 이동)였습니다. 필터 연산자 `!`는 다른 인수, 즉 터미널 명령어를 받아서 `column -t -s "|"`를 주었습니다. `column`이 어떻게 작동했는지는 다루지 않겠지만, 결과적으로 텍스트를 표로 만들었습니다.

텍스트를 표로 만들 뿐만 아니라 "Ok"가 있는 행만 표시하고 싶다고 가정해 봅시다. `awk`가 그 일을 쉽게 할 수 있다는 것을 알고 있습니다. 대신 이렇게 할 수 있습니다:

```
!}column -t -s "|" | awk 'NR > 1 && /Ok/ {print $0}'
```

결과:

```
02  Kitten  Ok
03  Bunny   Ok
```

훌륭합니다! 외부 명령어 연산자는 파이프(`|`)도 사용할 수 있습니다.

이것이 Vim의 조합성의 힘입니다. 연산자, 모션, 터미널 명령어를 더 많이 알수록 복잡한 작업을 구성하는 능력은 *곱해집니다*.

네 가지 모션, `w, $, }, G`와 단 하나의 연산자, `d`만 안다고 가정해 봅시다. 8가지 작업을 할 수 있습니다: 4가지 다른 방식으로 *이동* (`w, $, }, G`)하고 4가지 다른 대상을 *삭제* (`dw, d$, d}, dG`). 그러던 어느 날 대문자(`gU`) 연산자에 대해 배웁니다. Vim 도구 벨트에 단 하나의 새로운 능력을 추가한 것이 아니라 *네 가지*를 추가한 것입니다: `gUw, gU$, gU}, gUG`. 이것은 Vim 도구 벨트에 12개의 도구를 만듭니다. 각각의 새로운 지식은 현재 능력에 대한 승수입니다. 10개의 모션과 5개의 연산자를 안다면, 무기고에 60개의 움직임(50개의 작업 + 10개의 모션)이 있는 것입니다. Vim에는 줄 번호 모션(`nG`)이 있어 파일에 있는 줄 수만큼의 `n`개 모션을 제공합니다 (5번 줄로 이동하려면 `5G` 실행). 검색 모션(`/`)은 무엇이든 검색할 수 있기 때문에 거의 무한한 수의 모션을 제공합니다. 외부 명령어 연산자(`!`)는 알고 있는 터미널 명령어 수만큼의 필터링 도구를 제공합니다. Vim과 같은 조합 가능한 도구를 사용하면, 알고 있는 모든 것을 연결하여 복잡성이 증가하는 작업을 수행할 수 있습니다. 더 많이 알수록 더 강력해집니다.

이러한 조합 가능한 행동은 유닉스 철학인 *한 가지 일을 잘 하라*를 반영합니다. 연산자는 한 가지 일만 합니다: Y를 하라. 모션은 한 가지 일만 합니다: X로 가라. 연산자와 모션을 결합하면 예측 가능하게 YX를 얻습니다: X에 대해 Y를 하라.

모션과 연산자는 확장 가능합니다. Vim 도구 벨트에 추가할 사용자 지정 모션과 연산자를 만들 수 있습니다. [`vim-textobj-user`](https://github.com/kana/vim-textobj-user) 플러그인을 사용하면 자신만의 텍스트 객체를 만들 수 있습니다. 또한 사용자가 만든 사용자 지정 텍스트 객체 [목록](https://github.com/kana/vim-textobj-user/wiki)도 포함되어 있습니다.

## 현명하게 Vim 문법 배우기

방금 Vim 문법의 규칙인 `동사 + 명사`에 대해 배웠습니다. 제 가장 큰 Vim "아하!" 순간 중 하나는 대문자(`gU`) 연산자에 대해 막 배우고 현재 단어를 대문자로 만들고 싶었을 때, *본능적으로* `gUiw`를 실행했고 그것이 작동했을 때였습니다! 단어가 대문자로 바뀌었습니다. 그 순간, 저는 마침내 Vim을 이해하기 시작했습니다. 제 희망은 여러분도 곧, 이미 그렇지 않다면, 자신만의 "아하!" 순간을 갖게 되는 것입니다.

이 장의 목표는 Vim의 `동사 + 명사` 패턴을 보여줌으로써 모든 명령어 조합을 암기하는 대신 새로운 언어를 배우는 것처럼 Vim 학습에 접근하도록 하는 것입니다.

패턴을 배우고 그 의미를 이해하세요. 그것이 현명하게 배우는 방법입니다.