# Ch10. 실행 취소

우리 모두는 온갖 종류의 타이핑 실수를 합니다. 그렇기 때문에 실행 취소는 모든 현대 소프트웨어에서 필수적인 기능입니다. Vim의 실행 취소 시스템은 간단한 실수를 되돌리고 다시 실행할 수 있을 뿐만 아니라, 다른 텍스트 상태에 접근하여 지금까지 입력한 모든 텍스트를 제어할 수 있게 해줍니다. 이 장에서는 실행 취소, 다시 실행, 실행 취소 분기 탐색, 실행 취소 유지, 그리고 시간 여행하는 방법을 배웁니다.

## 실행 취소, 다시 실행, 그리고 UNDO

기본적인 실행 취소를 수행하려면 `u`를 사용하거나 `:undo`를 실행할 수 있습니다.

다음과 같은 텍스트가 있다면("one" 아래의 빈 줄에 주목):

```
one

```

그런 다음 다른 텍스트를 추가합니다:

```
one
two
```

`u`를 누르면, Vim은 "two" 텍스트를 실행 취소합니다.

Vim은 얼마나 실행 취소해야 하는지 어떻게 알까요? Vim은 점 명령어의 변경과 유사하게 한 번에 하나의 "변경"을 실행 취소합니다(점 명령어와 달리, 커맨드-라인 명령어 또한 변경으로 간주됩니다).

마지막 변경을 다시 실행하려면 `Ctrl-R`을 누르거나 `:redo`를 실행하세요. 위 텍스트를 실행 취소하여 "two"를 제거한 후, `Ctrl-R`을 실행하면 제거된 텍스트가 다시 나타납니다.

Vim에는 `U`로 실행할 수 있는 UNDO도 있습니다. 이것은 모든 최신 변경 사항을 실행 취소합니다.

`U`는 `u`와 어떻게 다를까요? 첫째, `U`는 마지막으로 변경된 줄의 *모든* 변경 사항을 제거하는 반면, `u`는 한 번에 하나의 변경 사항만 제거합니다. 둘째, `u`를 하는 것은 변경으로 간주되지 않지만, `U`를 하는 것은 변경으로 간주됩니다.

이 예로 돌아가서:

```
one
two
```

두 번째 줄을 "three"로 변경합니다:

```
one
three
```

두 번째 줄을 다시 변경하고 "four"로 바꿉니다:

```
one
four
```

`u`를 누르면 "three"가 보일 것입니다. `u`를 다시 누르면 "two"가 보일 것입니다. "four" 텍스트가 아직 있을 때 `u`를 누르는 대신 `U`를 눌렀다면, 다음과 같이 보일 것입니다:

```
one

```

`U`는 모든 중간 변경 사항을 건너뛰고 시작했을 때의 원래 상태(빈 줄)로 돌아갑니다. 또한, UNDO는 실제로 Vim에서 새로운 변경을 생성하므로, UNDO를 UNDO할 수 있습니다. `U` 다음에 `U`를 하면 스스로를 실행 취소합니다. `U`를 누르고, `U`를 누르고, `U`를 누르는 등을 할 수 있습니다. 동일한 두 텍스트 상태가 앞뒤로 전환되는 것을 볼 수 있습니다.

저는 개인적으로 원래 상태를 기억하기 어렵기 때문에(거의 필요하지 않음) `U`를 사용하지 않습니다.

Vim은 `undolevels` 옵션 변수에서 실행 취소할 수 있는 최대 횟수를 설정합니다. `:echo &undolevels`로 확인할 수 있습니다. 제 것은 1000으로 설정되어 있습니다. 여러분의 것을 1000으로 변경하려면 `:set undolevels=1000`을 실행하세요. 원하는 숫자로 자유롭게 설정하세요.

## 블록 깨기

앞서 `u`는 점 명령어의 변경과 유사하게 단일 "변경"을 실행 취소한다고 언급했습니다: 삽입 모드에 들어간 시점부터 종료할 때까지 삽입된 텍스트는 변경으로 간주됩니다.

`ione two three<Esc>`를 한 다음 `u`를 누르면, Vim은 전체 "one two three" 텍스트를 제거합니다. 왜냐하면 전체가 변경으로 간주되기 때문입니다. 짧은 텍스트를 작성했다면 큰 문제가 아니지만, 종료하지 않고 한 번의 삽입 모드 세션에서 여러 단락을 작성했고 나중에 실수를 깨달았다면 어떨까요? `u`를 누르면 작성한 모든 것이 제거될 것입니다. `u`를 눌러 텍스트의 일부만 제거할 수 있다면 유용하지 않을까요?

다행히도, 실행 취소 블록을 깰 수 있습니다. 삽입 모드에서 입력하는 동안 `Ctrl-G u`를 누르면 실행 취소 중단점이 생성됩니다. 예를 들어, `ione <Ctrl-G u>two <Ctrl-G u>three<Esc>`를 한 다음 `u`를 누르면, "three" 텍스트만 잃게 됩니다(`u`를 한 번 더 눌러 "two"를 제거). 긴 텍스트를 작성할 때, `Ctrl-G u`를 전략적으로 사용하세요. 각 문장의 끝, 두 단락 사이, 또는 코드 각 줄 뒤는 실수를 했을 경우 쉽게 실행 취소할 수 있도록 실행 취소 중단점을 추가하기에 좋은 위치입니다.

`Ctrl-W`(커서 앞 단어 삭제) 및 `Ctrl-U`(커서 앞 모든 텍스트 삭제)로 삽입 모드에서 덩어리를 삭제할 때 실행 취소 중단점을 만드는 것도 유용합니다. 한 친구가 다음 맵을 사용하라고 제안했습니다:

```
inoremap <c-u> <c-g>u<c-u>
inoremap <c-w> <c-g>u<c-w>
```

이것들로, 삭제된 텍스트를 쉽게 복구할 수 있습니다.

## 실행 취소 트리

Vim은 작성된 모든 변경 사항을 실행 취소 트리에 저장합니다. 새 빈 파일을 시작하세요. 그런 다음 새 텍스트를 추가합니다:

```
one

```

새 텍스트를 추가합니다:

```
one
two
```

한 번 실행 취소합니다:

```
one

```

다른 텍스트를 추가합니다:

```
one
three
```

다시 실행 취소합니다:

```
one

```

그리고 또 다른 다른 텍스트를 추가합니다:

```
one
four
```

이제 실행 취소하면, 방금 추가한 "four" 텍스트를 잃게 됩니다:

```
one

```

한 번 더 실행 취소하면:

```

```

"one" 텍스트를 잃게 됩니다. 대부분의 텍스트 편집기에서는 "two"와 "three" 텍스트를 다시 가져오는 것이 불가능했겠지만, Vim에서는 그렇지 않습니다! `g+`를 누르면 "one" 텍스트가 다시 나타납니다:

```
one

```

`g+`를 다시 입력하면 오랜 친구를 볼 수 있습니다:

```
one
two
```

계속 가봅시다. `g+`를 다시 누릅니다:

```
one
three
```

`g+`를 한 번 더 누릅니다:

```
one
four
```

Vim에서는 `u`를 누르고 다른 변경을 할 때마다 Vim은 "실행 취소 분기"를 생성하여 이전 상태의 텍스트를 저장합니다. 이 예에서, "two"를 입력한 다음 `u`를 누르고 "three"를 입력하면, "two" 텍스트를 포함하는 상태를 저장하는 잎 분기를 생성했습니다. 그 순간, 실행 취소 트리에는 적어도 두 개의 잎 노드가 포함되어 있었습니다: "three" 텍스트를 포함하는 주 노드(가장 최근)와 "two" 텍스트를 포함하는 실행 취소 분기 노드입니다. 또 다른 실행 취소를 하고 "four" 텍스트를 입력했다면, 세 개의 노드가 있었을 것입니다: "four" 텍스트를 포함하는 주 노드와 "three" 및 "two" 텍스트를 포함하는 두 개의 노드입니다.

각 실행 취소 트리 노드를 탐색하려면, `g+`를 사용하여 새로운 상태로, `g-`를 사용하여 오래된 상태로 이동할 수 있습니다. `u`, `Ctrl-R`, `g+`, `g-`의 차이점은 `u`와 `Ctrl-R`은 실행 취소 트리의 *주* 노드만 탐색하는 반면, `g+`와 `g-`는 실행 취소 트리의 *모든* 노드를 탐색한다는 것입니다.

실행 취소 트리는 시각화하기 쉽지 않습니다. 저는 [vim-mundo](https://github.com/simnalamburt/vim-mundo) 플러그인이 Vim의 실행 취소 트리를 시각화하는 데 매우 유용하다는 것을 발견했습니다. 그것을 가지고 놀 시간을 좀 가지세요.

## 영구적인 실행 취소

Vim을 시작하고, 파일을 열고, 즉시 `u`를 누르면, Vim은 아마도 "*Already at oldest change*" 경고를 표시할 것입니다. 변경 사항을 만들지 않았기 때문에 실행 취소할 것이 없습니다.

마지막 편집 세션의 실행 취소 기록을 이어가려면, Vim은 `:wundo`로 실행 취소 파일로 실행 취소 기록을 보존할 수 있습니다.

`mynumbers.txt` 파일을 만듭니다. 입력하세요:

```
one
```

그런 다음 다른 줄을 입력합니다(각 줄이 변경으로 간주되는지 확인):

```
one
two
```

다른 줄을 입력합니다:

```
one
two
three
```

이제 `:wundo {my-undo-file}`로 실행 취소 파일을 만듭니다. 기존 실행 취소 파일을 덮어써야 하는 경우, `wundo` 뒤에 `!`를 추가할 수 있습니다.

```
:wundo! mynumbers.undo
```

그런 다음 Vim을 종료합니다.

이제 디렉토리에 `mynumbers.txt`와 `mynumbers.undo` 파일이 있어야 합니다. `mynumbers.txt`를 다시 열고 `u`를 눌러보세요. 할 수 없습니다. 파일을 연 이후로 변경 사항을 만들지 않았습니다. 이제 `:rundo`로 실행 취소 파일을 읽어 실행 취소 기록을 로드합니다:

```
:rundo mynumbers.undo
```

이제 `u`를 누르면 Vim은 "three"를 제거합니다. `u`를 다시 눌러 "two"를 제거합니다. 마치 Vim을 닫지 않은 것과 같습니다!

자동으로 실행 취소를 유지하고 싶다면, 한 가지 방법은 vimrc에 다음을 추가하는 것입니다:

```
set undodir=~/.vim/undo_dir
set undofile
```

위의 설정은 모든 실행 취소 파일을 중앙 집중식 디렉토리인 `~/.vim` 디렉토리에 넣습니다. `undo_dir`이라는 이름은 임의적입니다. `set undofile`은 Vim에게 `undofile` 기능을 켜도록 지시합니다. 왜냐하면 기본적으로 꺼져 있기 때문입니다. 이제 저장할 때마다 Vim은 `undo_dir` 디렉토리 내에 관련 파일을 자동으로 생성하고 업데이트합니다(이것을 실행하기 전에 `~/.vim` 디렉토리 안에 실제 `undo_dir` 디렉토리를 만들어야 합니다).

## 시간 여행

시간 여행이 존재하지 않는다고 누가 말했나요? Vim은 `:earlier` 커맨드-라인 명령어로 과거의 텍스트 상태로 여행할 수 있습니다.

다음과 같은 텍스트가 있다면:

```
one

```
나중에 추가하면:

```
one
two
```

10초 전에 "two"를 입력했다면, 10초 전 "two"가 존재하지 않았던 상태로 돌아갈 수 있습니다:

```
:earlier 10s
```

`:undolist`를 사용하여 마지막 변경이 언제 이루어졌는지 볼 수 있습니다. `:earlier`는 다른 인수도 받습니다:

```
:earlier 10s    10초 전 상태로 이동
:earlier 10m    10분 전 상태로 이동
:earlier 10h    10시간 전 상태로 이동
:earlier 10d    10일 전 상태로 이동
```

또한, Vim에게 `count`번 이전 상태로 이동하도록 지시하기 위해 일반 `count`를 인수로 받습니다. 예를 들어, `:earlier 2`를 하면 Vim은 두 변경 전의 이전 텍스트 상태로 돌아갑니다. 이것은 `g-`를 두 번 하는 것과 같습니다. `:earlier 10f`로 10번 저장 전의 이전 텍스트 상태로 이동하도록 지시할 수도 있습니다.

동일한 인수 세트가 `:earlier`의 상대인 `:later`와 함께 작동합니다.

```
:later 10s    10초 후 상태로 이동
:later 10m    10분 후 상태로 이동
:later 10h    10시간 후 상태로 이동
:later 10d    10일 후 상태로 이동
:later 10     10번 새로운 상태로 이동
:later 10f    10번 저장 후의 상태로 이동
```

## 현명하게 실행 취소 배우기

`u`와 `Ctrl-R`은 실수를 수정하기 위한 두 가지 필수적인 Vim 명령어입니다. 먼저 그것들을 배우세요. 다음으로, 시간 인수를 사용하여 `:earlier`와 `:later`를 사용하는 방법을 배우세요. 그 후, 시간을 내어 실행 취소 트리를 이해하세요. [vim-mundo](https://github.com/simnalamburt/vim-mundo) 플러그인이 저에게 많은 도움이 되었습니다. 이 장의 텍스트를 따라 입력하고 각 변경을 할 때마다 실행 취소 트리를 확인하세요. 일단 파악하면, 다시는 실행 취소 시스템을 같은 방식으로 보지 않을 것입니다.

이 장 이전에, 프로젝트 공간에서 모든 텍스트를 찾는 방법을 배웠습니다. 실행 취소를 사용하면 이제 시간 차원에서 모든 텍스트를 찾을 수 있습니다. 이제 위치와 작성된 시간으로 모든 텍스트를 검색할 수 있습니다. 당신은 Vim-omnipresence를 달성했습니다.