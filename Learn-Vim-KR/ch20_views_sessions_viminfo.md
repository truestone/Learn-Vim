# Ch20. 뷰, 세션, 그리고 Viminfo

한동안 프로젝트에서 작업한 후에는 프로젝트가 자체 설정, 접기, 버퍼, 레이아웃 등으로 점차 형태를 갖추어가는 것을 발견할 수 있습니다. 마치 한동안 살았던 아파트를 장식하는 것과 같습니다. 문제는 Vim을 닫으면 그 변경 사항을 잃는다는 것입니다. Vim을 다음에 열 때 마치 떠난 적이 없는 것처럼 보이도록 그 변경 사항을 유지할 수 있다면 좋지 않을까요?

이 장에서는 뷰, 세션, Viminfo를 사용하여 프로젝트의 "스냅샷"을 보존하는 방법을 배웁니다.

## 뷰

뷰는 세 가지(뷰, 세션, Viminfo) 중 가장 작은 하위 집합입니다. 한 창에 대한 설정 모음입니다. 한 창에서 오랜 시간 작업하고 맵과 접기를 보존하고 싶다면 뷰를 사용할 수 있습니다.

`foo.txt`라는 파일을 만들어 봅시다:

```
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

이 파일에서 세 가지 변경 사항을 만듭니다:
1. 1번 줄에서, 수동 접기 `zf4j`를 만듭니다 (다음 4줄을 접습니다).
2. `number` 설정을 변경합니다: `setlocal nonumber norelativenumber`. 이것은 창의 왼쪽에 있는 숫자 표시기를 제거합니다.
3. `j`를 누를 때마다 한 줄 대신 두 줄 아래로 이동하도록 로컬 매핑을 만듭니다: `:nnoremap <buffer> j jj`.

파일은 다음과 같아야 합니다:

```
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

### 뷰 속성 구성하기

다음을 실행하세요:

```
:set viewoptions?
```

기본적으로 다음과 같이 표시되어야 합니다 (vimrc에 따라 다를 수 있습니다):

```
viewoptions=folds,cursor,curdir
```

`viewoptions`를 구성해 봅시다. 보존하고 싶은 세 가지 속성은 접기, 맵, 그리고 로컬 설정 옵션입니다. 제 설정처럼 보인다면, 이미 `folds` 옵션이 있습니다. 뷰에게 `localoptions`를 기억하도록 알려야 합니다. 다음을 실행하세요:

```
:set viewoptions+=localoptions
```

`viewoptions`에 사용할 수 있는 다른 옵션에 대해 배우려면 `:h viewoptions`를 확인하세요. 이제 `:set viewoptions?`를 실행하면 다음을 볼 수 있습니다:

```
viewoptions=folds,cursor,curdir,localoptions
```

### 뷰 저장하기

`foo.txt` 창이 제대로 접히고 `nonumber norelativenumber` 옵션이 있는 상태에서, 뷰를 저장해 봅시다. 다음을 실행하세요:

```
:mkview
```

Vim은 뷰 파일을 생성합니다.

### 뷰 파일

"Vim이 이 뷰 파일을 어디에 저장했지?"라고 궁금해할 수 있습니다. Vim이 어디에 저장하는지 보려면 다음을 실행하세요:

```
:set viewdir?
```

유닉스 기반 OS에서는 기본적으로 `~/.vim/view`라고 표시되어야 합니다 (다른 OS를 사용하는 경우 다른 경로가 표시될 수 있습니다. 더 많은 정보는 `:h viewdir`를 확인하세요). 유닉스 기반 OS를 사용하고 있고 다른 경로로 변경하고 싶다면, vimrc에 다음을 추가하세요:

```
set viewdir=$HOME/else/where
```

### 뷰 파일 로드하기

아직 닫지 않았다면 `foo.txt`를 닫은 다음, `foo.txt`를 다시 엽니다. **변경 사항 없이 원래 텍스트가 표시되어야 합니다.** 그것은 예상된 것입니다.

상태를 복원하려면 뷰 파일을 로드해야 합니다. 다음을 실행하세요:

```
:loadview
```

이제 다음을 볼 수 있습니다:

```
+-- 5 lines: foo1 -----
foo6
foo7
foo8
foo9
foo10
```

접기, 로컬 설정, 로컬 매핑이 복원됩니다. 주목하면, 커서도 `:mkview`를 실행했을 때 떠났던 줄에 있어야 합니다. `cursor` 옵션이 있는 한, 뷰는 커서 위치도 기억합니다.

### 여러 뷰

Vim은 번호가 매겨진 9개의 뷰(1-9)를 저장할 수 있습니다.

추가적인 접기(예: 마지막 두 줄을 접고 싶음)를 `:9,10 fold`로 만들고 싶다고 가정해 봅시다. 이것을 뷰 1로 저장해 봅시다. 다음을 실행하세요:

```
:mkview 1
```

`:6,7 fold`로 또 다른 접기를 만들고 다른 뷰로 저장하고 싶다면, 다음을 실행하세요:

```
:mkview 2
```

파일을 닫습니다. `foo.txt`를 열고 뷰 1을 로드하고 싶다면, 다음을 실행하세요:

```
:loadview 1
```

뷰 2를 로드하려면 다음을 실행하세요:

```
:loadview 2
```

원래 뷰를 로드하려면 다음을 실행하세요:

```
:loadview
```

### 뷰 생성 자동화하기

일어날 수 있는 최악의 일 중 하나는, 큰 파일을 접기로 정리하는 데 수많은 시간을 보낸 후, 실수로 창을 닫아 모든 접기 정보를 잃는 것입니다. 이것을 방지하기 위해, 버퍼를 닫을 때마다 자동으로 뷰를 생성하고 싶을 수 있습니다. vimrc에 다음을 추가하세요:

```
autocmd BufWinLeave *.txt mkview
```

또한, 버퍼를 열 때 뷰를 로드하는 것이 좋을 수 있습니다:

```
autocmd BufWinEnter *.txt silent loadview
```

이제 `txt` 파일로 작업할 때 뷰를 생성하고 로드하는 것에 대해 더 이상 걱정할 필요가 없습니다. 시간이 지남에 따라 `~/.vim/view`가 뷰 파일로 누적될 수 있다는 것을 명심하세요. 몇 달에 한 번씩 정리하는 것이 좋습니다.

## 세션

뷰가 한 창의 설정을 저장한다면, 세션은 모든 창의 정보(레이아웃 포함)를 저장합니다.

### 새 세션 만들기

`foobarbaz` 프로젝트에서 다음 3개의 파일로 작업하고 있다고 가정해 봅시다:

`foo.txt` 내부:

```
foo1
foo2
foo3
foo4
foo5
foo6
foo7
foo8
foo9
foo10
```

`bar.txt` 내부:

```
bar1
bar2
bar3
bar4
bar5
bar6
bar7
bar8
bar9
bar10
```

`baz.txt` 내부:

```
baz1
baz2
baz3
baz4
baz5
baz6
baz7
baz8
baz9
baz10
```

이제 `:split`과 `:vsplit`으로 창을 분할했다고 가정해 봅시다. 이 모양을 보존하려면 세션을 저장해야 합니다. 다음을 실행하세요:

```
:mksession
```

기본적으로 `~/.vim/view`에 저장하는 `mkview`와 달리, `mksession`은 현재 디렉토리에 세션 파일(`Session.vim`)을 저장합니다. 안에 무엇이 있는지 궁금하다면 파일을 확인해보세요.

세션 파일을 다른 곳에 저장하고 싶다면, `mksession`에 인수를 전달할 수 있습니다:

```
:mksession ~/some/where/else.vim
```

기존 세션 파일을 덮어쓰고 싶다면, `!`를 사용하여 명령어를 호출하세요 (`:mksession! ~/some/where/else.vim`).

### 세션 로드하기

세션을 로드하려면 다음을 실행하세요:

```
:source Session.vim
```

이제 Vim은 분할된 창을 포함하여 떠났던 그대로 보입니다! 또는, 터미널에서 세션 파일을 로드할 수도 있습니다:

```
vim -S Session.vim
```

### 세션 속성 구성하기

세션이 저장하는 속성을 구성할 수 있습니다. 현재 무엇이 저장되고 있는지 보려면 다음을 실행하세요:

```
:set sessionoptions?
```

제 것은 다음과 같이 말합니다:

```
blank,buffers,curdir,folds,help,tabpages,winsize,terminal
```

세션을 저장할 때 `terminal`을 저장하고 싶지 않다면, 세션 옵션에서 제거하세요. 다음을 실행하세요:

```
:set sessionoptions-=terminal
```

세션을 저장할 때 `options`를 추가하고 싶다면, 다음을 실행하세요:

```
:set sessionoptions+=options
```

`sessionoptions`가 저장할 수 있는 몇 가지 속성은 다음과 같습니다:
- `blank` 빈 창 저장
- `buffers` 버퍼 저장
- `folds` 접기 저장
- `globals` 전역 변수 저장 (대문자로 시작하고 적어도 하나의 소문자를 포함해야 함)
- `options` 옵션 및 매핑 저장
- `resize` 창 줄 및 열 저장
- `winpos` 창 위치 저장
- `winsize` 창 크기 저장
- `tabpages` 탭 저장
- `unix` 유닉스 형식으로 파일 저장

전체 목록은 `:h 'sessionoptions'`를 확인하세요.

세션은 프로젝트의 외부 속성을 보존하는 유용한 도구입니다. 하지만, 로컬 마크, 레지스터, 히스토리 등 일부 내부 속성은 세션에 의해 저장되지 않습니다. 그것들을 저장하려면 Viminfo를 사용해야 합니다!

## Viminfo

단어를 a 레지스터에 복사하고 Vim을 종료한 후, 다음에 Vim을 열 때 여전히 그 텍스트가 a 레지스터에 저장되어 있다는 것을 알아차렸을 것입니다. 이것은 실제로 Viminfo의 작업입니다. 그것이 없으면, Vim을 닫은 후에는 레지스터를 기억하지 못할 것입니다.

Vim 8 이상을 사용한다면, Vim은 기본적으로 Viminfo를 활성화하므로, 모르는 사이에 계속 Viminfo를 사용하고 있었을 수 있습니다!

"Viminfo는 무엇을 저장하나요? 세션과 어떻게 다른가요?"라고 물을 수 있습니다.

Viminfo를 사용하려면, 먼저 `+viminfo` 기능이 사용 가능해야 합니다 (`:version`). Viminfo는 다음을 저장합니다:
- 커맨드-라인 히스토리.
- 검색 문자열 히스토리.
- 입력-라인 히스토리.
- 비어 있지 않은 레지스터의 내용.
- 여러 파일에 대한 마크.
- 파일의 위치를 가리키는 파일 마크.
- 마지막 검색/치환 패턴 ('n' 및 '&'용).
- 버퍼 목록.
- 전역 변수.

일반적으로, 세션은 "외부" 속성을 저장하고 Viminfo는 "내부" 속성을 저장합니다.

프로젝트당 하나의 세션 파일을 가질 수 있는 세션과 달리, 보통 컴퓨터당 하나의 Viminfo 파일을 사용합니다. Viminfo는 프로젝트에 구애받지 않습니다.

유닉스의 기본 Viminfo 위치는 `$HOME/.viminfo` (`~/.viminfo`)입니다. 다른 OS를 사용하는 경우, Viminfo 위치가 다를 수 있습니다. `:h viminfo-file-name`을 확인하세요. 텍스트를 레지스터에 복사하는 것과 같은 "내부" 변경을 할 때마다, Vim은 자동으로 Viminfo 파일을 업데이트합니다.

*`nocompatible` 옵션이 설정되어 있는지 확인하세요 (`set nocompatible`). 그렇지 않으면 Viminfo가 작동하지 않습니다.*

### Viminfo 쓰기 및 읽기

하나의 Viminfo 파일만 사용하겠지만, 여러 Viminfo 파일을 만들 수 있습니다. Viminfo 파일을 쓰려면 `:wviminfo` 명령어(`:wv`로 축약)를 사용하세요.

```
:wv ~/.viminfo_extra
```

기존 Viminfo 파일을 덮어쓰려면, `wv` 명령어에 느낌표를 추가하세요:

```
:wv! ~/.viminfo_extra
```

기본적으로 Vim은 `~/.viminfo` 파일에서 읽습니다. 다른 Viminfo 파일에서 읽으려면 `:rviminfo` 또는 `:rv`로 축약하여 실행하세요:

```
:rv ~/.viminfo_extra
```

터미널에서 다른 Viminfo 파일로 Vim을 시작하려면, `i` 플래그를 사용하세요:

```
vim -i viminfo_extra
```

코딩과 글쓰기와 같이 다른 작업에 Vim을 사용하는 경우, 글쓰기에 최적화된 Viminfo와 코딩에 최적화된 다른 Viminfo를 만들 수 있습니다.

```
vim -i viminfo_writing

vim -i viminfo_coding
```

### Viminfo 없이 Vim 시작하기

Viminfo 없이 Vim을 시작하려면, 터미널에서 다음을 실행할 수 있습니다:

```
vim -i NONE
```

영구적으로 만들려면, vimrc 파일에 다음을 추가할 수 있습니다:

```
set viminfo="NONE"
```

### Viminfo 속성 구성하기

`viewoptions` 및 `sessionoptions`와 유사하게, `viminfo` 옵션으로 저장할 속성을 지시할 수 있습니다. 다음을 실행하세요:

```
:set viminfo?
```

다음을 얻을 것입니다:

```
!,'100,<50,s10,h
```

이것은 암호처럼 보입니다. 분석해 봅시다:
- `!` 대문자로 시작하고 소문자를 포함하지 않는 전역 변수를 저장합니다. `g:`가 전역 변수를 나타낸다는 것을 상기하세요. 예를 들어, 어느 시점에서 `let g:FOO = "foo"` 할당을 작성했다면, Viminfo는 전역 변수 `FOO`를 저장합니다. 하지만 `let g:Foo = "foo"`를 했다면, 소문자를 포함하기 때문에 Viminfo는 이 전역 변수를 저장하지 않습니다. `!`가 없으면, Vim은 그 전역 변수들을 저장하지 않습니다.
- `'100` 마크를 나타냅니다. 이 경우, Viminfo는 마지막 100개 파일의 로컬 마크(a-z)를 저장합니다. Viminfo에게 너무 많은 파일을 저장하도록 지시하면 Vim이 느려질 수 있다는 점에 유의하세요. 1000은 좋은 숫자입니다.
- `<50` 각 레지스터에 저장되는 최대 줄 수를 Viminfo에 알려줍니다 (이 경우 50). `a` 레지스터에 100줄의 텍스트를 복사하고(`"ay99j`) Vim을 닫으면, 다음에 Vim을 열고 `a` 레지스터에서 붙여넣을 때(`"ap`), Vim은 최대 50줄만 붙여넣습니다. 최대 줄 번호를 지정하지 않으면, *모든* 줄이 저장됩니다. 0을 지정하면 아무것도 저장되지 않습니다.
- `s10` 레지스터에 대한 크기 제한(kb 단위)을 설정합니다. 이 경우, 10kb보다 큰 레지스터는 제외됩니다.
- `h` Vim이 시작될 때 강조 표시(`hlsearch`에서)를 비활성화합니다.

전달할 수 있는 다른 옵션들이 있습니다. 더 배우려면 `:h 'viminfo'`를 확인하세요.

## 뷰, 세션, Viminfo 현명하게 사용하기

Vim에는 Vim 환경 스냅샷의 다른 수준을 취하는 뷰, 세션, Viminfo가 있습니다. 마이크로 프로젝트에는 뷰를 사용하세요. 더 큰 프로젝트에는 세션을 사용하세요. 뷰, 세션, Viminfo가 제공하는 모든 옵션을 확인하는 데 시간을 투자해야 합니다.

자신만의 편집 스타일에 맞는 자신만의 뷰, 세션, Viminfo를 만드세요. 컴퓨터 밖에서 Vim을 사용해야 할 때, 설정을 로드하기만 하면 즉시 집처럼 편안하게 느낄 수 있습니다!